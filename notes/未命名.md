摘要：
2023年5月份，我所在公司承担了某银行“智能终端管理系统”的开发工作，我作为该项目的系统架构设计师，主要负责该系统的需求分析和架构设计工作。该系统主要提升银行对智能收银终端软硬件的管理和维护，业务模块包括应用APP管理、设备管理、远程协助、屏媒广告等。本文以该项目为例，论述系统三层架构在该项目中的具体应用。在表现层，我们的客户端包括PC浏览器以及Andorid应用客户端，前者采用主流的VUE、iView的前端技术进行开发，构建出友好的用户界面；业务逻辑层，主要负责处理系统的核心业务，采用SprintBoot框架，将不同的业务功能进行模块化，分模块进行开发和维护；数据层，我们选择了Mybatis作为持久层框架，数据库选择MySQL，并使用数据库读写分离技术提升了访问效率。整个项目历时11个月开发完成，到目前运行稳定。实践证明，三层架构的设计，不仅提升了开发效率，缩短了开发周期，并为后续的持续优化奠定了基础。

正文：
随着互联网技术的迅猛发展，传统的收银设备操作系统简单、功能单一、无法远程升级（OTA），同时设备的使用状态也无从得知，智能设备替代传统设备成为一个趋势。为了增加商户的粘性，提升服务质量，各大银行开始加大智能收银设备的投放。不同于传统的收银设备，智能设备搭载着Android系统，操作系统强大，联网能力强，具备处理更多更复杂业务场景的能力。为了充分发挥智能设备的优势，并进一步加强对商户设备的监管能力，银行提出了建设一个关于智能终端管理系统的需求，实时监控设备状态，并对设备的软硬件生命周期进行有效的管理。
2023年五月份，我所在公司承担了该银行的智能终端管理系统的开发工作，我作为该系统的架构设计师，参与整个开发过程。该系统的主要业务模块包括软件APP管理、设备管理、远程协助以及屏媒广播等。建设该系统旨在解决行方的需求，提升对收银终端监控水平的同时，也提高了行方工作人员的维护效率。应用APP管理模块，主要功能包括应用上架、应用管理等。银行或者商户可定制自己的专属应用市场，在管理平台上上架自己的APP。银行作为管理方，还具备权限更高的能力，对自己机构下的商户，针对不同业态的商户配置应用的可见性。设备管理模块，主要包括设备总览、定制设备和远程更新功能。银行通过平台的可视化界面，能够清晰的获取各商户设备的软硬件使用状态。针对初次装机的场景，银行还可以在银行定制装机初始化任务，设备联网后首次开机，会从平台获取装机任务，一键完成系统配置、应用预装等功能，极大提升了银行的装机效率。远程协助模块，主要包括文件的远程传输、录屏以及远程控制功能。针对常见的场景，比如软件BUG问题，银行可通过平台的远程协助入口，远程连接设备，查看设备底层版本信息、拉取对应日志。这也为银行提升了维护效率。屏媒广告模块，主要包括媒体资源管理、广告数据播放统计等功能。银行对于这一块有着较高的诉求，可通过对商户的设备远程投放广告、宣传片来宣传或获取一部分收益，同时通过平台的屏媒广告入口，还可以得到广播的播放情况统计。

由于银行对系统的安全性、可用性、可靠性以及响应速度要求，我们选择了三层架构作为该系统的软件体系结构。三层架构作为一种经典的软件体系结构，它对系统进行分层次设计，层次间职责分离、相互独立，便于系统的维护和扩展。下面我将分层次详细介绍三层架构在本系统中的应用。

首先，在表现层，我们采用了VUE、iView等前端技术进行构建。VUE作为一款轻量级的框架，易于上手，便于项目组中的新人快速掌握。另外，它采用虚拟DOM和组件化的方式来提高渲染、性能较高。表现层和用户直接交互，操作体验我们非常重视，所以我选择了VUE作为前端技术。iView作为一款开源的高质量UI组件库，组件库覆盖导航、布局、数据输入等多个方面，几乎覆盖了所有常见的web应用场景。同时，它的API设计友好，开发者能够快速上手，所以我选择了它作为前端的UI组件库。

其次，业务逻辑层是系统的核心部分，采用主流的SprintBoot框架进行开发，使得开发人员能够专注于表现逻辑和业务逻辑的开发。通过框架的使用，缩短了开发周期，减少了开发费用和维护费用，提高了开发的成功率。为了实现Android客户端和智能终端管理系统的有效长连接，我们引入了MQTT消息中间件。通过MQTT中间件，系统能够将银行或商户的配置，精准、实时地推送到商户设备上。这非常重要，系统的很多功能都依赖于该机制，该机制是系统能够正常运行的保障。同时，考虑业务逻辑层对性能的要求较高，为了避免数据库频繁访问导致性能降低，我们引入了Redis缓存机制，针对系统配置、设备信息、应用信息等热点数据进行缓存。从而极大提高了系统的性能和访问效率。另外，为了增强系统的可用性，防止过多的请求对系统造成过载，我们还针对客户端的请求实现了请求限制，针对客户端短时间内的频繁请求，超过指定的阈值，服务器将拒绝服务并返回错误。

最后，在数据层的设计上，我们使用Mybatis作为持久层框架，数据库选择MySQL。Mybatis简单易学、灵活并且解决了SQL语句和程序代码的耦合。通过DAO的使用，将业务逻辑和数据访问逻辑分离，提高了开发效率，使得系统的设计更加合理、清晰，并具备更好的维护性。为了应对高并发可能导致的数据库访问压力过大，我们还设计实现了数据库读写分离机制。主数据库负责写操作，从数据库负责读操作，减轻了主库的压力。另外，为了提升设备信息、应用APP信息的查询速度，我们还针对SQL语句和索引进行了优化，并使用批量操作的SQL语句来减少数据库的访问次数。例如在更新设备状态或应用信息时，我们将多条语句合并成一条批量更新语句。

整个项目历时11个月开发完成，并于2024年4月份成功上线，到目前运行稳定，市场反馈良好。尽管该架构带来了很多优势，当实际应用中也遇到了一些困难。比如本方案设计的Redis热点数据缓存机制，在某些场景下，仍然出现了缓存命中率偏低，导致频繁访问数据库的问题。针对这个问题，一方面我们会通过延长热点数据的有效时间，另一方面，针对未命中的数据，在缓存中存储一个空值，并设置一个较短的有效时间，避免短时间内数据库被频繁访问，减轻数据库压力。

实践证明，基于三层架构设计模式，不仅降低了开发成本、提高了团队开发效率，同时，系统在大规模设备管理中展现出了的稳定性。通过表示层、业务逻辑层以及数据层的分工协作，实现了系统的高效、灵活和安全，有效提升了银行对智能终端的管理效率，减少了设备维护成本。从项目完工的效果来看，达到了预期目标，也获得了行方的一致好评。

通过这次参与三层架构设计的实施后，认识到了自己仍然存在这一些不足，在未来还会不断的更新知识，完善本系统的各方面设计，我们相信能够更好的满足不断变化的业务需求，并提升系统的整体性能和稳定性。在位公司创造价值的同事，也为客户开发出更稳定可靠的系统。

